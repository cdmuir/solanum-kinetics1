---
title: Guard cell size and pore aperture influence stomatal closure kinetics
format:
  pdf:
    keep-tex: true  
    toc: false
author:
  - name: "Christopher D. Muir$^{1,2*}$"
    orcid: 0000-0003-2555-3878
  - name: "Wei Shen Lim$^{1}$"
affiliations: false
number-sections: false
header-includes: |
  \usepackage{hyperref}
  \addtokomafont{disposition}{\rmfamily}
  \usepackage{siunitx}
  \newcommand{\Aamphi}{$A_{\mathrm{amphi}}$}
  \newcommand{\Ahypo}{$A_{\mathrm{hypo}}$}
  \newcommand{\agcurve}{$A \textendash g_\text{sw}$}
  \newcommand{\ca}{$C_\mathrm{a}$}
  \newcommand{\caequals}[1]{$C_\mathrm{a} = \SI{#1}{\micro\mol\raiseto{-1}\mol}$}
  \newcommand{\cabetween}[2]{#1 < $C_\mathrm{a} < \SI{#2}{\micro\mol\raiseto{-1}\mol}$}
  \newcommand{\fgmax}{$f_\text{gmax}$}
  \newcommand{\gcl}{$l_\text{gc}$}
  \newcommand{\gmax}{$g_\text{max}$}
  \newcommand{\gmaxratio}{$g_\text{max,ratio}$}
  \newcommand{\gmaxshade}{$g_\text{max,shade}$}
  \newcommand{\gmaxsun}{$g_\text{max,sun}$}
  \newcommand{\gsw}{$g_\text{sw}$}
  \newcommand{\loggsw}{$\log(g_\text{sw})$}
  \newcommand{\logA}{$\log(A)$}
  \newcommand{\ppfd}{$\mathrm{PPFD}$}
  \newcommand{\ppfdequals}[1]{$\mathrm{PPFD} = \SI{#1}{\micro\mole\per\meter\squared\per\second}$}
  \newcommand{\ppfdqty}[1]{$\SI{#1}{\micro\mole\per\meter\squared\per\second}$}
  \newcommand{\rh}{$\mathrm{RH}$}
  \newcommand{\rhequals}[1]{$\mathrm{RH} = #1\%$}
  \newcommand{\tleafequals}[1]{$T_\mathrm{leaf} = \SI{#1}{\degreeCelsius}$}
  \usepackage{setspace}
  \usepackage[modulo]{lineno}
  \usepackage{physics}
  \usepackage{pifont}
  \newcommand{\cmark}{\ding{51}}
mainfont: Times New Roman
bibliography: solanum-kinetics.bib
csl: https://www.zotero.org/styles/pnas
---

```{=latex}
\begin{center}
$^1$School of Life Sciences, University of Hawaiʻi; Mānoa, Hawaiʻi, USA\\
$^2$Department of Botany, University of Wisconsin, Madison; Wisconsin, USA\\
\medskip
*Corresponding author: cdmuir@wisc.edu\\
\medskip
ORCID: Christopher D. Muir — \href{https://orcid.org/0000-0003-2555-3878}{0000-0003-2555-3878}\\
\medskip
Classification: Biological Sciences, Ecology\\
\medskip
Keywords: amphistomy, leaf gas exchange, \textit{Solanum}, stomatal kinetics, stomatal size
\end{center}
```

```{r load-objects, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
library(brms)
library(cowplot)
library(dplyr)
library(ggplot2)
library(glue)
library(kableExtra)
library(knitr)
library(lubridate)
library(magrittr)
library(purrr)
library(readr)
library(stringr)
library(tibble)
library(tidyr)

theme_set(theme_cowplot())

source("../r/functions.R")

plant_info = read_rds("../data/plant_info.rds")

accession_info = read_rds("../data/accession_info.rds")

rh_curves = read_rds("../data/rh_curves.rds")
joined_data = read_rds("../data/joined-data.rds")

response_vars = tibble(
  definition = c(
    fgmax = "stomatal conductance as a fraction of anatomical maximum stomatal conductance",
    gcl = "guard cell length",
    lambda = "lag time",
    tau = "time constant"
  ),
  symbol = c(
    fgmax = "$f_\\text{gmax}$",
    gcl = "$l_\\text{gc}$",
    lambda = "$\\lambda$",
    tau = "$\\tau$"
  )
)

# Methods

licor_date_range = plant_info |>
  filter(acc_id %in% unique(joined_data$acc_id)) |>
  dplyr::select(`1s_rh_response_date`, `2s_rh_response_date`) |>
  pivot_longer(cols = everything()) |>
  pull(value) |>
  ymd() |>
  range(na.rm = TRUE) 
n_weeks = prettyNum(as.numeric(difftime(licor_date_range[2], licor_date_range[1], units = "days")) / 7, digits = 3)
 # number of weeks for LICOR measurements
start_licor_date = format(licor_date_range[1], "%B %d, %Y")
end_licor_date = format(licor_date_range[2], "%B %d, %Y")

# Environmental data
df_germ_summary = read_rds("../data/df_germ_summary.rds") |>
  ungroup() |>
  summarize(value = median(value), .by = c("period", "variable", "parameter"))

df_growth_summary = read_rds("../data/df_growth_summary.rds") |>
  ungroup() |>
  filter(!is.na(value)) 

# environmental condition in germination room

germ_temp_day = df_germ_summary |>
  filter(period == "day", variable == "degC", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)
  
germ_temp_night = df_germ_summary |>
  filter(period == "night", variable == "degC", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

germ_rh_day = df_germ_summary |>
  filter(period == "day", variable == "RH", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

germ_rh_night = df_germ_summary |>
  filter(period == "night", variable == "RH", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

germ_ppfd = df_germ_summary |>
  filter(period == "day", variable == "PAR", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

# environmental conditions in growth room

d1 = df_growth_summary |>
  summarize(value = median(value),
            .by = c("period", "rack", "variable", "parameter"))

ppfd_sun = d1 |>
  filter(period == "day", rack == "lower", variable == "PAR", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

ppfd_shade = d1 |>
  filter(period == "day", rack == "upper", variable == "PAR", parameter == "mu") |>
  pull(value) |>
  prettyNum(digits = 3)

# data on chamber light conditions
percent_red = rh_curves |>
  mutate(p_red = Q_red / Q) |>
  summarize(p_red = mean(p_red, na.rm = TRUE),
            .by = c(acc_id, light_intensity)) |>
  summarize(p_red = mean(p_red, na.rm = TRUE), .by = light_intensity) |>
  pivot_wider(names_from = light_intensity, values_from = p_red)

p_red_high = format(signif(100 * percent_red$`2000`, 3), nsmall = 1)
p_blue_high = format(signif(100 * (1 - percent_red$`2000`), 3), nsmall = 1)
p_red_low = format(signif(100 * percent_red$`150`, 3), nsmall = 1)
p_blue_low = format(signif(100 * (1 - percent_red$`150`), 3), nsmall = 1)

# H2O_r in chambers
mean_h2or = joined_data |>
  summarize(H2O_r = mean(H2O_r), .by = curve) |>
  summarize(H2O_r = median(H2O_r, na.rm = TRUE)) |>
  pull(H2O_r)

# Results
fit = read_rds("../objects/best_model.rds")

n_acc = length(unique(fit$data$accession))

# Effect of growth light treatment on log(tau)
post_summary = posterior_summary(fit)
post_tau_sun = post_summary["b_logtaumean_lighttreatmentsun", ]
post_tau_high = post_summary["b_logtaumean_lightintensityhigh", ]
post_lambda_sun = post_summary["b_loglambdamean_lighttreatmentsun", ]
post_lambda_high = post_summary["b_loglambdamean_lightintensityhigh", ]

tab_estimates = read_csv("../tables/tab-estimates.csv", show_col_types = FALSE)

median_tau = tab_estimates |>
  filter(trait == "tau") |>
  pull(estimate) |>
  median()

max_tau = tab_estimates |>
  filter(trait == "tau") |>
  pull(estimate) |>
  max()

median_lambda = tab_estimates |>
  filter(trait == "lambda") |>
  pull(estimate) |>
  median()

max_lambda = tab_estimates |>
  filter(trait == "lambda") |>
  pull(estimate) |>
  max()

partial_cor = read_rds("../objects/partial-cor.rds") |>
  filter(name == "logtaumean_Intercept__loggcl_Intercept")
rho = partial_cor$median
rho_lower = partial_cor$lower
rho_upper = partial_cor$upper
```

Reminder: Halliwell et al. 2025 paper has useful info on multiresponse models. I might use Van de Pol and Wright (2009) method for within versus between slope estimation. This is in the phylogenetic comparative example in the brms vignette too. Actually, this is hard to implement because I would have to calculate individual residuals for each light treatment combination and then means of those, etc.

Westoby et al (2023) (10.1111/1365-2745.14150) is similar to Halliwell. Maybe another way to think about it using the mutliresponse approach.

## Abstract

Guard cell size and stomatal density vary over X and X orders of magnitude among extant vascular land plants, yet the adaptive significance of much of this variation remains unclear. The evolution of guard cell size in particular is poorly understood and may even be constrained by nonadaptive features like genome size. One hypothesis is that natural selection may favor smaller guard cells to increase the rate at which stomatal conductance responds to fluctuating environmental conditions. A related hypothesis is that operational stomatal conductance (gop) is often $\approx 25\%$ of its theoretical maximum (gmax) because at this stomatal aperture, guard cell volume is poised to change rapidly with changes in turgor pressure. The support for both hypothesis is limited and mixed, in part because they have not been tested together, even though both guard cell size and the ratio of gop to gmax (gop:gmax) should influence stomatal kinetics. We measured stomatal closure kinetics in response to an abrupt increase in vapor pressure deficit (VPD) among `r n_acc` diverse wild tomato populations in the genus \textit{Solanum}. Both smaller guard cell size and lower gop:gmax were associated with faster stomatal closure kinetics, but at different levels of biological organization. Guard cell size explained X% of the variance in stomatal kinetics among populations, whereas gop:gmax explained X% of the variance among individuals within populations. [neither result would have been supported if analyzed in isolation - is this true?]. We conclude that guard cell size may respond to selection on stomatal kinetics over evolutionary time, but actual kinetics are modulated by a tradeoff between maximizing gop and minimizing the time required for stomatal closure. Putting these hypotheses together with stabilizing selection on gop may explain why stomatal size and density negatively covary among species.

## Introduction

NOTE: I need to develop a consistent terminology - stomatal response rate? speed? kinetics?

In nature, change is the only constant. One way that vascular plants (tracheophytes) cope with change is by adjusting stomatal pore aperture to optimize the trade-off between carbon gain and water loss. In the absence of physical limits and energetic tradeoffs, natural selection would favor plants that could instantaneously adjust stomatal conductance (\gsw)  to perfectly track dynamic environmental conditions. In reality, stomatal responses take time, creating a lag between actual and optimal stomatal aperture. X ions must be pumped across ... and active responses depend on multiple feedback loops involving gene expression/ABA synthesis?/etc (Buckley). [illustrative empirical example or real numbers illustrating the problem]. Changes in stomatal aperture could be faster if there were more channels (?) per area, but this would require more energy (ATP?) and space allocated to XX proteins in the guard cell membrane. 

It might seem that natural selection should favor faster stomatal responses to get closer to the ideal of instantaneous optimization. Under this assumption, variation in stomatal kinetics would depend on how strong directional selection for faster responses is counterbalanced by costs of faster stomata. We discuss multiple, nonmutually exclusive costs below [WHERE?]. However, once models account for inevitable time lags, natural selection can favor slower responses when this prevents overreacting to unpredictable and shortlived changes in the environment. [Review some lit] It is therefore likely that the direction of selection on stomatal response rate varies depending on the predictability and duration of environmental fluctuations, as well as the energetic costs of stomatal movements.

What traits respond to selection on stomatal kinetics? We consider two interconnected hypotheses that have thus far been treated in isolation. The first hypothesis is that smaller guard cells open and close faster because of their intrinsically greater surface area to volume ration [@drake_smaller_2013; @woning_revisiting_2026]. For approximately cylindrical cell geometries, like that found in guard cells (citation on guard cell shape?), surface area increases linearly with radius, whereas volume increases in proportion to the radius squared. Consequently, larger guard cells will require more time to pump enough ions (wc?) to achieve a given change in turgor pressure and, hence, stomatal pore aperture. A plant with large guard cells can partially compensate for this geometric constraint by increasing the density of transporters (wc?) in the guard cell membrane [@raven_speedy_2014] (haworth et al 2023 have some cites about this). However, this may be limited by the available membrane area and/or energetic costs of maintaining high transporter densities. Empirical support for the hypothesis that smaller guard cells are faster is mixed. Some studies have found negative correlations between guard cell size and stomatal response rate [@drake_smaller_2013] (cites), whereas others have found no relationship (cites). (apparently hetherington and woodward 2003 mention size-speed relationship too - check that. Lawson and Blatt 2014 throw shade on size being deterministic)

One factor that might complicate the relationship between size and speed is aperture. Stomatal aperture can vary from near 0 when guard cell turgor pressure is low and asymptotically approach gmax as guard cell turgor pressure approaches $\infty$ (Figure 1X). The nonlinear relationship between guard cell turgor and pore aperture implies that if rate of change in turgor change is constant ($\dv{P}{t} = C$), the rate of change in aperture, and hence stomatal conductance, will vary depending on the initial aperture. When initial aperture is high, stomatal conductance will respond more slowly than when initial aperture is low. Since we generally do not observe individual stomatal aperture, extending this idea to macroscale phenomena requires scaling by stomatal density. We will use the term "fraction of anatomical maximum stomatal conductance", symbolized as \fgmax. This value should be proportional to the average aperture divided by its maximum aperture for any arbitrary stomatal density [could a figure show how this interacts with stomatal density?]. Leaves operating at fgmax closer to unity will, all else being equal, will be slower to respond than leaves operating with a \fgmax close to zero, independent of stomatal density. @franks_physiological_2012 hypothesized that selection on stomatal density would maintain typical operational stomatal conductance (gop) relative to gmax at a sufficiently low value that stomatal conductance would be sensitive to relatively small changes in guard cell turgor pressure. Consistent will this hypothesis, gop:gmax is often near 0.25 [@mcelwain_using_2016; @murray_consistent_2020], well below $f_\text{gmax} = 1$, and in a range where \gsw would be responsive to small changes in guard cell turgor pressure.

Putting these two hypotheses together, we predict that both guard cell size and fgmax will influence stomatal kinetics, but possibly at different scales of biological organization. Guard cell size tends to vary less than stomatal density or aperture at many biological scales. For example, on a mature leaf, guard cell size is essentially fixed other than small changes in volume caused by turgor pressure (cite). Compared to stomatal density, guard cell size is also less developmentally plastic varies less genetically within species (cites). If there is relatively little plastic or genetic variation among individuals within a species, then most of the variance in stomatal kinetics within species cannot be explained by variation in stomatal size. In contrast, \fgmax varies immensely within and among individuals because stomatal aperture responds dynamically over the day and in response to environmental variation. Within a single leaf, \fgmax will change over the course of a day in response to light signalling, change in VPD, and starch accumulation (or sink strength? cite). During the life a leaf, \fgmax will change in response to long-term stresses such as drought. Because guard cell size and aperture typically vary at different levels of biological organization, we predict that guard cell size likely explains more variation in stomatal kinetics among species, whereas \fgmax will explain more variation within species. Within species variation can arise from either genetic or environmental differences between individuals. Neither of these traits along will determine all or even most of the variance in stomatal kinetics, which is a complex response to many internal and external signals (cites).

Here we extend recent advances in phylogenetic comparative methods [@westoby_phylogenetically_2023; @muir_how_2023; @halliwell_multiresponse_2025] to test these predictions using data on stomatal closure kinetics in response to an abrupt increase in VPD among `r n_acc` diverse wild tomato populations in the genus *Solanum*. We leveraged natural variation in guard cell size among and within species to test whether leaves with smaller guard cells close faster. We induced variation in fgmax through a combination of growth and measurement light intensity. Growth light intensity caused developmental plasticity in stomatal density that, when crossed factorially with measurement light intensity, resulted in variation in fgmax. By measuring multiple individuals from multiple treatments across multiple species enabled us to estimate the effect of guard cell size and \fgmax on stomatal kinetics and partition their significance within and among species.





<!-- might be good paper to revisit and cite: -->
<!-- Pinpointing the causal influences of stomatal anatomy and behavior on minimum, operational, and maximum leaf surface conductance -->

<!-- another recent paper on gop:gmax using Franks et al 2012 concept: -->
<!-- https://doi.org/10.1093/aob/mcaf224 -->

[not sure where this goes]
many, large - slow because of large size, but fast because of low gop
few, small - slow because of high gop, but fast because of small size
some, moderate - best of both worlds?
IDEA FOR FIGURE - use empirical estimates to predict tau (z-axis) for a given optimal gs as a function of 




Is there a connection here to size-density scaling? It’s an empirical regularity, not a law of nature that higher gmax is associated with smaller stomata. This is an observation that requires explanation, not a presumption of truth. 

What's never been done before is to put these two ideas together. This means that weak relationships between size and speed might be because people have not controlled for aperture (gop:gmax ratio).

Factors cannot also manifest at different scales of biological organization. Here we focus on two levels: variation among species and variation among individuals within species. To consider it abstractly, if factors A and B influnce trait C according to some mechanistic model, but factor A is typically fixed within species but varies among species, then B will explain much of the variation in C within species. But if A varies among species, then A will explain much of the variation in C among species. We hypothesize that stomatal size is relatively constant within species, but varies among species.  In contrast, aperture (gop:gmax) varies because of mismatches between leaf anatomy and gopt.


And that smaller stomata are faster.

These are related because the benefit of small stomata goes away if gop is really high.



hooks:


Haworth et al (2018) paper arguing faster adaxial kinetics (I think). Check other cites in Woning and Horak




Stomatal kinetics are important for optimizing response to rapid fluctuations in light, leaf temperture, and VPD

curve shape does not match what you'd expect for constant alpha term

Anatomy possibly matters: shape and size

Adaxial stomata might close faster (why?)

What we did:\
1. model stomatal close with hysteresis (can it explain overshoot and wrong-way response?

2.  compare tau in tomatoes to that in rice
3.  test for effect of size
4.  test if adaxial+abaxial is faster than abaxial alone

Phenomenologically, the following equation describes how stomatal conductance responds to step changes in light intensity across dozens of plant species [@woning_revisiting_2026]:

$$
  g_\text{sw} = g_\text{f} + (g_\text{i} - g_\text{f}) e^{-\left(\frac{t}{\tau}\right)^\lambda}.
$$ {#eq-weibull}

In this equation, \gsw is stomatal conductance at time $t$, $g_\text{i}$ is the initial \gsw before the step change, $g_\text{f}$ is the final \gsw after the step change, $\tau$ is a time constant that describes how quickly stomata respond to the step change, and $\lambda$ is a shape parameter that describes how the response rate changes over time. When $\lambda = 1$, the response rate is constant over time and $\tau$ represents the time required for \gsw to reach `r formatC(100 * exp(-1), 3)`% of the way between initial and final values. When $\lambda > 1$, the response rate increases over time, and when $\lambda < 1$, the response rate decreases over time. @woning_revisiting_2026 refer to $\lambda$ as a lag-time parameter because empirically $\lambda > 1$. We find the same pattern for responses to a step change in VPD (see results) and therefore adopt their terminology. We refer to stomatal kinetic parameters $\tau$ (time-constant) and $\lambda$ (lag-time) henceforth.

## Methods

### Populations

We analyzed stomatal responses to changing humidity among `r n_acc` ecologically diverse populations of wild tomato, including representatives of all described species of *Solanum* sect. *Lycopersicon* and sect. *Lycopersicoides* [@peralta_taxonomy_2008] and the cultivated tomato *S. lycopersicum* var. *lycopersicum* (@tbl-populations), as described in @muir_plasticity_2025. These populations were selected because they encompass the breadth of climatic variation in the wild tomato clade [@pease_phylogenomics_2016]. In one case, we substituted a congeneric population of the species (*S. galapagense*) because of difficulty growing the focal population and we also added a population of *S. pennellii*. Due to constraints on growth space and time, we spread out measurements over `r n_weeks` weeks from `r start_licor_date` to `r end_licor_date`. Replicates within population were evenly spread out over this period to prevent confounding of temporal variation in growth conditions with variation among populations. 

```{r, populations, eval=TRUE,echo=FALSE,message=FALSE,warning=FALSE}
#| label: tbl-populations
#| tbl-cap: "Accession information of *Solanum* populations used in this study. The species name, accession number, collection latitude, longitude, and elevation. TGRC: Tomato Genetics Resource Center."

# Copied from solanum-aq project

accession_info |>
  filter(accession %in% joined_data$acc) |>
  arrange(species, accession) |>
  select(
    Species = species,
    `TGRC accession` = accession,
    `Latitude` = lat,
    `Longitude` = lon,
    `Elevation (mas)` = elev
  ) |>
  knitr::kable(
    format = "latex",
    digits = c(rep(0, 2), 3, 3, 0),
    booktabs = TRUE,
    longtable = TRUE,
    escape = FALSE
  ) |>
  kableExtra::kable_styling(latex_options = c("striped", "no_vertical_lines", "repeat_header")) |>
  kableExtra::column_spec(1, width = "3.25cm", italic = TRUE)

```

### Plant growth conditions and light treatments

A thorough description of plant growth conditions can be found @muir_plasticity_2025, therefore we summarize the most important information here. Seeds provided by the Tomato Genetics Resource Center germinated on moist paper in plastic boxes after soaking for 30-60 minutes in a 50% (volume per volume) solution of household bleach and water, followed by a thorough rinse. We transferred seedlings to cell-pack flats containing Pro-Mix BX potting mix (Premier Tech, Rivière-du-Loup, Quebec, Canada) once cotyledons fully emerged, typically within 1-2 weeks of sowing. We grew seeds and seedlings for both sun and shade treatments under the same environmental conditions (12:12 h, `r germ_temp_day`:$\SI{`r germ_temp_night`}{\degreeCelsius}$, `r germ_rh_day`:`r germ_rh_night` RH day:night cycle). LED light provided $\mathrm{PPFD} = \SI{`r germ_ppfd`}{\micro\mole\per\meter\squared\per\second}$ (Fluence RAZRx, Austin, Texas, USA) during the germination and seedling stages.

Immediately prior to starting growth light intensity treatments (sun and shade), we transplanted seedlings to 3.78 L plastic pots containing 60% Pro-Mix BX potting mix, 20% coral sand (Pro-Pak, Honolulu, Hawaiʻi, USA), and 20% cinders (Niu Nursery, Honolulu, Hawaiʻi, USA) withslow release NPK fertilizer following manufacturer instructions (Osmocote Smart-Release Plant Food Flower & Vegetable, The Scotts Company, Marysville, Ohio, USA). Percentage composition is on a volume basis. We watered to field capacity three times per week to prevent drought stress. Seedlings were randomly assigned in alternating order within population to the sun or shade treatment during transplanting. The average daytime \ppfd{} was \ppfdqty{`r ppfd_sun`} and \ppfdqty{`r ppfd_shade`} for sun and shade treatments, respectively. 

### Humidity response curves

We selected a fully expanded, unshaded leaf at least six leaves above the cotyledons during early vegetative growth. This typically meant that plants had grown in light treatments for $\approx$ 4 weeks, ensuring they had time to sense and respond developmentally to the light intensity of the treatment rather than the seedling conditions [@schoch_dependence_1980]. See @muir_plasticity_2025 for further detail.

To measure stomatal responses to a step change in humidity, we first acclimated the focal leaf to high humidity, rapidly decreased the humidity, and logged \gsw through time. We refer to this as a humidity-response curve. We measured humidity-response curves using a portable infrared gas analyzer (LI-6800PF, LI-COR Biosciences, Lincoln, Nebraska, USA). Light-acclimated plants were placed under LEDs dimmed to match their light treatment during gas exchange measurements. We estimated \gsw at ambient CO$_2$ (\caequals{415}) and \tleafequals{25.0}. 

We collected four humidity-response curves per leaf, an amphi (untreated) curve and a pseudohypo (treated) curve at high light-intensity (\ppfdequals{2000}; `r p_red_high`:`r p_blue_high` red:blue) and low light-intensity (\ppfdequals{150}; `r p_red_low`:`r p_blue_low` red:blue). We always measured high light-intensity curves first because photosynthetic downregulation is faster than upregulation in these species. Pseudohypostomatous leaves are the same as the amphistomatous leaves except gas exchange through the upper (adaxial) surface blocked by a neutral density plastic (propafilm). Comparing amphi and pseudohypo curves on the same leaf enables us to test whether stomatal kinetics are different for ab- and adaxial stomata on the same leaf. To compensate for reduced transmission, we increased incident \ppfd{} for pseudohypo leaves by a factor 1/0.91, the inverse of the measured transmissivity of the propafilm. We also set the stomatal conductance ratio, for purposes of calculating boundary layer conductance, to 0 for pseudohypo leaves following manufacturer directions.

To control for order effects, we alternated between starting with amphi or pseudohypo leaf measurements. We made measurements over two days. On the first day, we measured high and low light-intensity curves for either amphi or pseudohypo leaves; on the second day, we measured high and low light-intensity curves on the other leaf type.  The irradiance of the light source in the pseudohypo leaf was higher because the propafilm reduces transmission. 

In all cases, we acclimated the focal leaf to high light (\ppfdequals{2000}) and high relative humidity (\rhequals{70}) until \gsw{} reached its maximum. After that, we scrubbed water vapor from the incoming air using silica desiccant as quickly as possible, resulting in a water vapor concentration in the incoming air to be on average $\SI{`r formatC(mean_h2or, 3)`}{\milli\mol\per\mol}$. This treatment induced rapid stomatal closure, but it did not standardize chamber air humidity because water vapor was introduced by leaf transpiration. HOWEVER - NO RELATIONSHIP BETWEEN FINAL GSW AND TAU (fill in details). This treatment was designed to elicit a rapid stomatal response and not necessarily mimic natural environmental variability. All other environmental conditions in the leaf chamber remained the same. We started logging data after the transient "wrong-way response" (citation) and continued logging data until \gsw{} reached its nadir. We then acclimated the leaf to low light (\ppfdequals{150}) and \rhequals{70} before inducing stomatal closure with low \rh{} and logging data as described above.

### Hypothesis generation and testing

The primary aims and *a priori* hypotheses of this study are described in @muir_plasticity_2025. The idea to use \gsw response curves to test hypotheses about which traits influence stomatal kinetics came after the data had been collected, but not yet analyzed. We started with two *a priori* hypotheses based on a recent metaanalysis of stomatal responses to light [@woning_revisiting_2026]. We hypothesized that 1) guard cell size would influence $\tau$ and 2) that $\tau$ would be greater on the abaxial-only leaves. We planned to compare relationships within and among populations using phylogenetic comparative methods. We made the decision to test for an association between \fgmax and $\tau$ after exploratory analyses revealed a potential association. Adding hypotheses after some results have been analyzed, also known as "Hypothesizing After Results Known" (HARKing), can lead to reports of spurious associations that are not repeatable in later studies [@kerr_harking_1998; @smaldino_natural_2016]. Therefore, our conclusions about the effect of \fgmax on stomatal kinetics should be interpreted with caution until they are replicated.

We estimated $\tau$ and $\lambda$ for each response curve by fitting @eq-weibull to a time-series of \gsw values using Bayesian nonlinear regression. WORKING HERE

We fit multiresponse Bayesian mixed effects models with phylogenetically structured random effects to answer the following core questions:

1. Are \gcl and \fgmax positively associated with $\tau$?
2. At what biological levels of organization do \gcl and \fgmax influence $\tau$?
3. Are abaxial-only stomatal responses slower than whole leaf stomatal responses?

SCRAPS THAT I NEED TO WEAVE INTO MS

We used a combination of model selection and parameter estimation to evaluate these hypotheses. All statistical models included fixed effects of manipulative treatments: growth light intensity (sun and shade); measurement light intensity (high and low); and curve type (amphistomatous and pseudohypostomatous). All models also included population as a phylogenetically structured random effect. 

We accounted for uncertainty in $\tau$ and $\lambda$ using the standard deviation of the posterior distribution of each estimate (see above). 

We used the RAxML whole-transcriptome concatenated phylogeny based on 2,745 100-kb genomic windows from @pease_phylogenomics_2016. Two of our populations were not in this tree. We used accession LA1044 in place of LA3909, two populations of *S. galapagense*; LA0750 was added as sister to LA0716, two closely related populations of *S. pennellii*. The node separating LA0750 from LA0716 was placed half-way between the next deepest node. 

### inferring different levels of effects??

We analyzed three nonmutually exclusive paths through which \fgmax and \gcl could influence stomatal kinetic parameters $\lambda$ and $\tau$. First, we inferred phylogenetic effects by estimating the phylogenetic correlation among populations between anatomical (\fgmax and \gcl) and kinetic ($\lambda$ and $\tau$) variables. To test for causation, we used the phylogenetic covariance matrix to estimate partial correlations between anatomical and kinetic variables [@halliwell_multiresponse_2025]. We interpret a significant partial correlation between variables as a plausible causal hypothesis. Second, we inferred individual-level effects of \fgmax and \gcl on kinetic parameters using linear multiple regression that simultaneously accounts for phylogenetic and treatment effects. We used the leave-one-out cross-validation information criterion (LOOIC) to compare the fit of models using the *R* package **loo** version `r packageVersion("loo")` [@vehtari_practical_2017] to calculate LOOIC values. We compared models with all permutations of \fgmax and \gcl influencing $\lambda$ and $\tau$. We selected the model with the lowest LOOIC value (@tbl-comparison) to generate posterior predictions for hypothesis testing. If an effect was included in the best model (lowest LOOIC), then we considered whether the 95% confidence interval overlapped zero to ascertain a significant effect. 

THIRD: mediating treatment effects (plasticity)


### Variance decomposition and heritability (somewhere)

We decomposed the variance in log-transformed response variables ($\lambda$, $tau$, \fgmax, \gcl) into phylogenetic, population, between-individual, and within-individual levels. The phylogenetic variance component quantifies trait evolution between populations congruent with the phylogenetic relationships, whereas the population component quantifies variance among populations independent of phylogenetic relationships [@lynch_methods_1991; @garamszegi_general_2014]. The between- and within-individual variance components quantify variance among individuals within the same population and treatment. The within-individual component was estimated from repeated measures of the same leaf at different light intensities. It was not possible to estimate within-individual variance in guard cell length with our study design because we only measured average guard cell length once per leaf. We estimated the between-individual variance from the residual variance, which also includes measurement error. The phylogenetic heritability is equivalent to the phylogenetic variance component and is estimated following @lynch_methods_1991; @garamszegi_general_2014 as:

$$h^2_{\mathrm{phy}} = \frac{\sigma^2_\mathrm{phy}}{\sigma^2_\mathrm{phy} + \sigma^2_\mathrm{pop} + \sigma^2_\mathrm{between} + \sigma^2_\mathrm{within}},$$

where $\sigma^2_\mathrm{phy}$, $\sigma^2_\mathrm{pop}$, $\sigma^2_\mathrm{between}$, and $\sigma^2_\mathrm{within}$ are the phylogenetic, population, between-individual, and within-individual variance components, respectively. 

### Model comparison (somewhere)

add info

## Results

```{r, echo = FALSE, eval = FALSE}
# ACTUALLY, i think just get rid of t50 because if you use 1 / e instead of 1 / 2, then tau is all that matters
# Derivation of t_50 for CD Weibull model:
# gf + dg / 2 = gf + dg * exp(-(t_sec / tau)^lambda)
# dg / 2 = dg * exp(-(t_sec / tau)^lambda)
# 1 / 2 = exp(-(t_sec / tau)^lambda)
# log(1 / 2) = -(t_sec / tau)^lambda
# -log(1 / 2) = (t_sec / tau)^lambda
# log(2) = (t_sec / tau)^lambda
# log(2) ^ (1 / lambda) = t_sec / tau
# tau * log(2) ^ (1 / lambda) = t_sec
```

Stomatal conductance (\gsw) decrease rapidly in response to a step increase in VPD. Consider a typical leaf in the experiment possessing the median time constant ($\tau$) and lag time ($\lambda$) among wild tomato accessions in all treatments. After VPD increased the transient wrong way response elapsed, it took `r prettyNum(round(median_tau * log(2) ^ (1 / median_lambda)))` s for \gsw to decrease half-way ($t_{50}$) from its initial to final steady state value. In terms of the kinetic model parameters, most variation among leaves was due to difference in the time constant rather than the lag time. In the previous example, increasing $\lambda$ from its median to its maximum estimated value among accessions increased the $t_{50}$ by only `r prettyNum(round(median_tau * log(2) ^ (1 / max_lambda) - median_tau * log(2) ^ (1 / median_lambda), 1))` s. In contrast, increasing $\tau$ from its median to maximum value increased $t_{50}$ by `r prettyNum(round(max_tau * log(2) ^ (1 / median_lambda) - median_tau * log(2) ^ (1 / median_lambda)))` s

Growth light intensity did not significantly affect $\tau$ [@fig-accession-kinetics; @tab-fit-amphi]. In sun plants, $\tau$ was on average `r signif(100 * (exp(post_tau_sun["Estimate"]) - 1), 3)`% [95% CI: `r signif(100 * (exp(post_tau_sun["Q2.5"]) - 1), 3)` to `r signif(100 * (exp(post_tau_sun["Q97.5"]) - 1), 3)`%] lower than in shade plants after accounting for other explanatory variables. Within the same leaf, increasing the measurement light intensity prior to the VPD step change from \ppfdqty{150} to \ppfdqty{2000} significantly increased $\tau$ by `r signif(100 * (exp(post_tau_high["Estimate"]) - 1), 3)`% [95% CI: `r signif(100 * (exp(post_tau_high["Q2.5"]) - 1), 3)` to `r signif(100 * (exp(post_tau_high["Q97.5"]) - 1), 3)`%] [@fig-accession-kinetics; @tab-fit-amphi]. The time lag $\lambda$ responded to growth, but not measurement light intensity after accounting for other explanatory variables [@fig-accession-kinetics; @tab-fit-amphi]. In sun plants, $\tau$ was on average `r signif(100 * (exp(post_lambda_sun["Estimate"]) - 1), 3)`% [95% CI: `r signif(100 * (exp(post_lambda_sun["Q2.5"]) - 1), 3)` to `r signif(100 * (exp(post_lambda_sun["Q97.5"]) - 1), 3)`%] greater than in shade plants. Higher measurement light decreased increased $\lambda$ slightly by `r signif(100 * (exp(post_lambda_high["Estimate"]) - 1), 3)`% [95% CI: `r signif(100 * (exp(post_lambda_high["Q2.5"]) - 1), 3)` to `r signif(100 * (exp(post_lambda_high["Q97.5"]) - 1), 3)`%]. 

- table of symbols?
- table of model estimates for tau and lambda

```{r, accession-kinetics, echo = FALSE}
#| label: fig-accession-kinetics
#| fig-align: center
#| fig-cap: "\\textbf{Stomatal kinetics parameters $\\lambda$ (lag time; top facets) and $\\tau$ (time constant; lower facets) vary among wild tomato populations.} Stomatal conductance decreases faster (lower $\\tau$) in response to a step change in vapor pressure deficit (VPD) in leaves when measured under low light intensity. The pattern was consistent for both shade (left facets) and sun (right facets) grown plants. The pattern for $\\lambda$$ was qualitatively similar to that for $\\tau$. Each point is the average parameter value for one accession in that treatment combination. The growth and measurement light intensity treatments are described in the Materials and Methods section."

knitr::include_graphics("../figures/accession-kinetics.pdf")
```

```{r, fit-amphi, echo = FALSE}
#| label: tab-fit-amphi

# placeholder for table of model estimates
iris %>%
  group_by(Species) %>%
  summarise(mean = mean(Sepal.Length), sd = sd(Sepal.Length)) %>%
  kable() %>%
  kable_styling()
```

Among the four traits in our model (\fgmax, \gcl, $\lambda$, and $\tau$), the preponderance of the variance was typically within or between individuals after accounting for treatment effects [@fig-variance; @tbl-variance]. The exception to this pattern was \gcl{}, for which the phylogenetic component (aka phylogenetic heritability) was larger [@fig-variance]. The population component independent of phylogeny explained little of the trait variation. The between-individual variance was usually high, but this component confounds true between-individual variance with measurement error, so should be interpreted with caution. 

```{r, variance, echo = FALSE}
#| label: fig-variance
#| fig-align: center
#| fig-cap: "\\textbf{foo} bar."

knitr::include_graphics("../figures/variance.pdf")
```

```{r, variance-cap, echo = FALSE}
symbol_definitions = glue("{symbol}: {definition}", .envir = as.environment(response_vars)) |>
  str_c(collapse = "; ")
cap_text = glue("Variance components of stomatal kinetic traits. The phylogenetic component is equivalent to the phylogenetic heritability. The population component is the nonphylogenetic variance among populations. Between- and within-individual variance components are among individuals within a population after accounting for treatment effect. Estimates and 95% confidence intervals (CI) are estimated as the median and quantile intervals of the posterior distribution. {symbol_definitions}.")
```

```{r, variance}
#| label: tbl-variance
#| tbl-cap: !expr cap_text
#| results: asis
#| echo: false
#| message: false
#| warning: false

tab_variance = read_rds("../objects/tbl-variance.rds") 

tv2 = tab_variance |>
  summarize(n = n(), .by = Trait) |>
  mutate(
    Trait = str_replace_all(Trait, "\\\\", "\\\\\\\\"),
    cumsum = cumsum(n))

tab_variance |>
  select(-Trait) |>
  kable(
      format = "latex",
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE
      ) |>
    kable_styling(latex_options = c("repeat_header", "hold_position")) |>
    pack_rows(tv2$Trait[1],
             1,
             tv2$cumsum[2],
             escape = FALSE) |>
    pack_rows(tv2$Trait[2],
             tv2$cumsum[1] + 1,
             tv2$cumsum[2],
             escape = FALSE) |>
    pack_rows(tv2$Trait[3],
             tv2$cumsum[2] + 1,
             tv2$cumsum[3],
             escape = FALSE) |>
    pack_rows(tv2$Trait[4],
             tv2$cumsum[3] + 1,
             tv2$cumsum[4],
             escape = FALSE) 
```

Guard cell size and \fgmax affected stomatal kinetics, but at different levels of biological organization. In the model with the lowest LOOIC (see @tbl-comparison for model comparison results), the only significant partial correlation was between \gcl and $\tau$ ($\rho = `r signif(rho, 2)`$ [95% CI: `r signif(rho_lower, 2)` to `r signif(rho_upper, 2)`$) was a significant phylogenetic correlation between \gcl and $\tau$ [@fig-?]. PARTIAL CORRELATION RESULT. Variation in \gcl within populations did not explain within-population variation in $\tau$ [@tbl-fit]. NOTE THAT BEST MODEL RETAINED INDIVIDUAL LEVEL EFFECT OF GCL, BUT COEFFICIENT WAS NOT SIGNIFICANT. OTHER BEST MODELS DID NOT RETAIN THIS. DID GCL MEDIATE AFFECT OF TREATMENTS?


Need to show (this is a growing, incomplete list):
- model comparison results table
- figure of tau versus gcl per accession
- phylogenetic partial correlation
- partial correlation showing that gcl and tau are (only?) significant phylogenetic covariates

```{r fit}
#| label: tbl-fit
#| results: asis
#| echo: false
#| message: false
#| warning: false

clean_repsonse_var = function(.x) {
  case_when(
    .x == "logfgmax" ~ "$\\log(f_g)$",
    .x == "loggcl" ~ "$\\log(l_\\mathrm{gc})$",
    .x == "loglambdamean" ~ "$\\log(\\lambda)$",
    .x == "logtaumean" ~ "$\\log(\\tau)$",
    TRUE ~ .x
  )
}

clean_explanatory_var = function(.x) {
  case_when(
    .x == "Intercept" ~ "intercept (shade, low light)",
    .x == "lighttreatmentsun" ~ "sun growth treatment",
    .x == "lightintensityhigh" ~ "high measurement light intensity",
    .x == "logfgmax" ~ "$\\log(f_g)$",
    .x == "loggcl" ~ "$\\log(l_\\mathrm{gc})$",
    .x == "loglambdamean" ~ "$\\log(\\lambda)$",
    .x == "logtaumean" ~ "$\\log(\\tau)$",
    TRUE ~ .x
  )
}

describe_effect = function(explanatory, response) {
  if (str_detect(explanatory, "^intercept")) {
    explanatory
  } else {
    glue("effect of {explanatory} on {response}")
  }
}

fx1 = fixef(fit, summary = TRUE) |>
  as.data.frame() |>
  tibble::rownames_to_column("par") |>
  mutate(
    across(where(is_double), ~ formatC(., format = "f", digits = 2)),
    `Estimate [95\\% CI]` = glue("{Estimate} [{Q2.5}, {Q97.5}]"),
    par = str_replace(par, "curve_type", "curvetype")
  ) |>
  separate_wider_delim(par, delim = "_", names = c("response", "explanatory")) |>
  mutate(
    response = clean_repsonse_var(response),
    explanatory = clean_explanatory_var(explanatory)
  ) |>
  rowwise() |>
  mutate(
    Parameter = describe_effect(explanatory, response)
  ) |>
  ungroup() |>
  arrange(response, explanatory) 

fx2 = fx1 |>
  summarize(n = n(), .by = response) |>
  mutate(
    response = str_replace_all(response, "\\\\", "\\\\\\\\"),
    cumsum = cumsum(n)
  )

fx1 |>
  select(Parameter, `Estimate [95\\% CI]`) |>
    kable(
      format = "latex",
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Fixed effects (posterior mean, SE, and 95\\% confidence intervals)."
    ) |>
    kable_styling(latex_options = c("repeat_header", "hold_position")) |>
    row_spec(0, bold = TRUE) |>
    pack_rows(fx2$response[1],
            1,
            fx2$cumsum[1],
            escape = FALSE) |>
    pack_rows(fx2$response[2],
             fx2$cumsum[1] + 1,
             fx2$cumsum[2],
             escape = FALSE) |>
  pack_rows(fx2$response[3],
             fx2$cumsum[2] + 1,
             fx2$cumsum[3],
             escape = FALSE) |>
  pack_rows(fx2$response[4],
             fx2$cumsum[3] + 1,
             fx2$cumsum[4],
             escape = FALSE) |>
  column_spec(1, width = "4in") |>
  column_spec(2, width = "2in")

```

```{r, foo}
#| label: tbl-foo
#| results: asis
#| echo: false
#| message: false
#| warning: false

df_comparison = read_rds("../objects/tbl-comparison.rds") |>
  select(`$\\Delta \\text{LOOIC}$`, `$\\lambda$__\\fgmax`, `$\\lambda$__\\gcl`, `$\\tau$__\\fgmax`, `$\\tau$__\\gcl`)

kbl(
  df_comparison,
  format = "latex",
  booktabs = TRUE,
  escape = FALSE,
  col.names = str_remove(colnames(df_comparison), "^.*__"),
  align = c("l", rep("c", 4))
) |>
  add_header_above(c(" " = 1, "$\\\\lambda$" = 2, "$\\\\tau$" = 2), escape = FALSE) |>
  kable_styling(latex_options = c("hold_position", "striped"))
```

## References

::: {#refs}
:::

{{< pagebreak >}}

# Supplementary Materials

```{=latex}
\renewcommand{\thefigure}{S\arabic{figure}}
\renewcommand{\thetable}{S\arabic{table}}
\renewcommand{\theequation}{S\arabic{equation}}
\setcounter{figure}{0}
\setcounter{table}{0}
\setcounter{equation}{0}
\setcounter{page}{1}
```

## MANUSCRAPS

Note: this theory did not really pan out. It did not come up with models that really fit better than the CD Weibull model and they included an extra parameter. Therefore, I am tabling this for now and trying OnGuard3 instead.

### Theory

Our goal here is derive equations that integrate the effects of guard cell size and aperture on stomatal kinetics. A fully mechanistic model is beyond the scope of our goals here. Instead, we use phenomenological equations that adequately capture empirical patterns. There are three main assumptions of our model. First, we assume linear relaxation kinetics for guard cell turgor pressure ($P$):

$$ \frac{d P}{d t} = \frac{P^* - P}{\tau}.$$
In this differential equation, $P^*$ is the equilibrium turgor pressure and $\tau$ is a time constant that determines the speed of relaxation. Solving this equation gives:

$$ P(t) = P^* + [P(0) - P^*] e^{-t/\tau}, $$
where $P(0)$ is the initial turgor pressure at time $t=0$.

The rate of relaxation is determined by the surface area to volume ratio. Assume constant transport per surface area. Surface area determined by geometry. 

What is eqn for this?



