---
title: Guard cell size and pore aperture influence stomatal closure kinetics
format:
  pdf:
    keep-tex: true  
    toc: false
author:
  - name: "Christopher D. Muir$^{1,2*}$"
    orcid: 0000-0003-2555-3878
  - name: "Wei Shen Lim$^{1}$"
affiliations: false
number-sections: false
header-includes: |
  \usepackage{hyperref}
  \addtokomafont{disposition}{\rmfamily}
  \usepackage{siunitx}
  \newcommand{\Aamphi}{$A_{\mathrm{amphi}}$}
  \newcommand{\Ahypo}{$A_{\mathrm{hypo}}$}
  \newcommand{\agcurve}{$A \textendash g_\text{sw}$}
  \newcommand{\ca}{$C_\mathrm{a}$}
  \newcommand{\caequals}[1]{$C_\mathrm{a} = \SI{#1}{\micro\mol\raiseto{-1}\mol}$}
  \newcommand{\cabetween}[2]{#1 < $C_\mathrm{a} < \SI{#2}{\micro\mol\raiseto{-1}\mol}$}
  \newcommand{\gmax}{$g_\text{max}$}
  \newcommand{\gmaxratio}{$g_\text{max,ratio}$}
  \newcommand{\gmaxshade}{$g_\text{max,shade}$}
  \newcommand{\gmaxsun}{$g_\text{max,sun}$}
  \newcommand{\gsw}{$g_\text{sw}$}
  \newcommand{\loggsw}{$\log(g_\text{sw})$}
  \newcommand{\logA}{$\log(A)$}
  \newcommand{\ppfd}{$\mathrm{PPFD}$}
  \newcommand{\ppfdequals}[1]{$\mathrm{PPFD} = \SI{#1}{\micro\mol\raiseto{-2}\meter\raiseto{-1}\second}$}
  \newcommand{\ppfdqty}[1]{$\SI{#1}{\micro\mole\per\meter\squared\per\second}$}
  \newcommand{\rh}{$\mathrm{RH}$}
  \newcommand{\rhequals}[1]{$\mathrm{RH} = #1\%$}
  \newcommand{\tleafequals}[1]{$T_\mathrm{leaf} = \SI{#1}{\degreeCelsius}$}
  \usepackage{setspace}
  \usepackage[modulo]{lineno}
  \usepackage{physics}
mainfont: Times New Roman
bibliography: solanum-kinetics.bib
csl: https://www.zotero.org/styles/pnas
---

```{=latex}
\begin{center}
$^1$School of Life Sciences, University of Hawaiʻi; Mānoa, Hawaiʻi, USA\\
$^2$Department of Botany, University of Wisconsin, Madison; Wisconsin, USA\\
\medskip
*Corresponding author: cdmuir@wisc.edu\\
\medskip
ORCID: Christopher D. Muir — \href{https://orcid.org/0000-0003-2555-3878}{0000-0003-2555-3878}\\
\medskip
Classification: Biological Sciences, Ecology\\
\medskip
Keywords: amphistomy, leaf gas exchange, \textit{Solanum}, stomatal kinetics, stomatal size
\end{center}
```

```{r load-objects, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
library(brms)
library(cowplot)
library(dplyr)
library(ggplot2)
library(glue)
library(kableExtra)
library(knitr)
library(lubridate)
library(magrittr)
library(readr)
library(stringr)
library(tibble)
library(tidyr)

theme_set(theme_cowplot())

source("../r/functions.R")

# Results
fit_amphi = read_rds("../objects/best_amphi_model.rds")

n_acc = length(unique(fit_amphi$data$accession))

# Effect of growth light treatment on log(tau)
post_summary = posterior_summary(fit_amphi)
post_tau_sun = post_summary["b_logtaumean_lighttreatmentsun", ]
post_tau_high = post_summary["b_logtaumean_lightintensityhigh", ]
post_lambda_sun = post_summary["b_loglambdamean_lighttreatmentsun", ]
post_lambda_high = post_summary["b_loglambdamean_lightintensityhigh", ]

tab_estimates = read_csv("../tables/tab-estimates.csv", show_col_types = FALSE)

median_tau = tab_estimates |>
  filter(trait == "tau") |>
  pull(estimate) |>
  median()

max_tau = tab_estimates |>
  filter(trait == "tau") |>
  pull(estimate) |>
  max()

median_lambda = tab_estimates |>
  filter(trait == "lambda") |>
  pull(estimate) |>
  median()

max_lambda = tab_estimates |>
  filter(trait == "lambda") |>
  pull(estimate) |>
  max()

```

blah [@tbl-variance]

```{r, variance}
#| label: tbl-variance
#| results: asis
#| echo: false
#| message: false
#| warning: false

tab_variance = read_rds("../objects/tbl-variance.rds") 

tv2 = tab_variance |>
  summarize(n = n(), .by = Trait) |>
  mutate(
    Trait = str_replace_all(Trait, "\\\\", "\\\\\\\\"),
    cumsum = cumsum(n))

tab_variance |>
  select(-Trait) |>
  kable(
      format = "latex",
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      caption = "Variance components and phylogenetic heritability of stomatal kinetic traits."
    ) |>
    kable_styling(latex_options = c("repeat_header", "hold_position")) |>
    pack_rows(tv2$Trait[1],
             1,
             tv2$cumsum[2],
             escape = FALSE) |>
    pack_rows(tv2$Trait[2],
             tv2$cumsum[1] + 1,
             tv2$cumsum[2],
             escape = FALSE) |>
    pack_rows(tv2$Trait[3],
             tv2$cumsum[2] + 1,
             tv2$cumsum[3],
             escape = FALSE) |>
    pack_rows(tv2$Trait[4],
             tv2$cumsum[3] + 1,
             tv2$cumsum[4],
             escape = FALSE) 
```
